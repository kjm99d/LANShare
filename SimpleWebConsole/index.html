<!DOCTYPE html>
<html>

<head>
    <title>LANShare Simple WebConsole</title>

    <script type="text/javascript" src="./js/jquery-3.6.3.min.js"></script>
    <script>
            const strServerURL = "http://localhost:5004"
            var absPath = "C:\\";


            function FTP(path) {
                console.log(path)
                // Ï≤´ ÏöîÏ≤≠Ïãú CÎìúÎùºÏù¥Î∏åÏóê ÌååÏùºÏ†ïÎ≥¥Î•º Í∞ÄÏ†∏Ïò®Îã§.
                $.get({
                    url: strServerURL + "/ftp?path=" + path,
                    success: (res) => {
                        $("#ftp_body").empty();
                        absPath = absPath.replace(absPath, path);

                        let row = "";
                        for (item of res) {

                            const is_dir = item["is_dir"];
                            const file_type = (is_dir ? "üìÇ" : "üìÑ")
                            const name = item["name"];
                            const file_size = (item["size"] === undefined ? "" : item["size"])

                            row = row + "<tr>";
                            row = row + "<td>" + file_type + "</td>";
                            row = row + "<td>" + name + "</td>";
                            row = row + "<td>" + file_size + "</td>";

                            if (is_dir)
                                row = row + "<td onclick=FTP(\"" + (absPath + name) + "\")>" + "‚è¨" + "<td>"

                            row = row + "</tr>";

                        }

                        $("#ftp_body").append(row);
                    },
                    error: (xhr, status, err) => {

                    }
                });
            }

        $(document).ready(function () {



            const onClickSendAllButton = () => {

                const strFileSrc = $("#filepath").val();
                const strSaveFileName = $("#filename").val();
                console.log(strFileSrc, strSaveFileName)
                SendAll(strFileSrc, strSaveFileName);
            };

            const SendAll = (src_path, dst_filename) => {
                $.ajax({
                    url: "http://localhost:5004/SendAll",
                    data: JSON.stringify({ filepath: src_path, filename: dst_filename }),
                    dataType: "json", 
                    method: "post",
                    contentType : "application/json; charset=utf-8",
                    success: function (res) {

                    },
                    error: function (xhr, status, error) {

                    }
                });
            };


            const SendTo = (target, src_path, dst_filename) => {
                $.ajax({
                    url: "http://localhost:5004/SendTo",
                    data: "",
                    method: "post",
                    success: function (res) {

                    },
                    error: function (xhr, status, error) {

                    }
                });
            };
            
            // SetEvent
            $("#btnSendAll").on("click", onClickSendAllButton);


            
            FTP(absPath);
            
        });
    </script>

    <style>
        tr {
            border : 1px solid black;
        }
    </style>
</head>

<body>
    <a>PATH </a><input type="text" id="filepath" /> </br>
    <a>Target </a><input type="text" /> </br>
    <a>Filename </a><input type="text" id="filename" /> </br>
    <button id="btnSendAll">SendAll</button>

    <p>FTP Viewer</p>
    <p id="current_path">PATH = </p>
    
    <table>
        <thead>
            <tr>
                <th>ÌååÏùºÌÉÄÏûÖ</th>
                <th>ÌååÏùºÎ™Ö</th>
                <th>Ïö©Îüâ</th>
                <th>-</th>
            </tr>
        </thead>
        <tbody id="ftp_body">
            <tr>
                <td>s</td>
            </tr>
        </tbody>
    </table>

</body>

</html>